version: "3.9"
services:
  transmission:
    image: lscr.io/linuxserver/transmission:latest
    container_name: pimilor-transmission
    environment:
      PUID: ${PUID:-1000}
      PGID: ${PGID:-1000}
      TZ: ${TZ:-America/Los_Angeles}
      PEERPORT: ${PIMILOR_TRANSMISSION_PORT_INBOUND:-51413}
      TRANSMISSION_WEB_HOME: /config/ui/${PIMILOR_TRANSMISSION_WEBUI}
    ports:
      - ${PIMILOR_TRANSMISSION_PORT_UI:-9091}:9091
      - ${PIMILOR_TRANSMISSION_PORT_INBOUND:-51413}:51413
      - ${PIMILOR_TRANSMISSION_PORT_INBOUND:-51413}:51413/udp
    restart: unless-stopped
    volumes:
      - ${PIMILOR_TRANSMISSION_PATH:-./transmission}:/config
      - cofbilion:/downloads
    deploy:
      placement:
        constraints: [node.labels.pimilor == true]
      resources:
        limits:
          cpus: '4.00'
          memory: 8G
        reservations:
          cpus: '2.00'
          memory: 6G

  jackett:
    image: lscr.io/linuxserver/jackett:latest
    container_name: pimilor-jackett
    environment:
      PUID: ${PUID:-1000}
      PGID: ${PGID:-1000}
      TZ: ${TZ:-America/Los_Angeles}
      AUTO_UPDATE: "TRUE"
    ports:
      - ${PIMILOR_JACKETT_PORT:-9117}:9117
    restart: unless-stopped
    volumes:
      - ${PIMILOR_JACKETT_PATH:-./jackett}:/config
      - cofbilion:/downloads
    deploy:
      placement:
        constraints: [node.labels.pimilor == true]

  sonarr:
    image: lscr.io/linuxserver/sonarr:latest
    container_name: pimilor-sonarr
    environment:
      PUID: ${PUID:-1000}
      PGID: ${PGID:-1000}
      TZ: ${TZ:-America/Los_Angeles}
    ports:
      - ${PIMILOR_SONARR_PORT:-8989}:8989
    restart: unless-stopped
    volumes:
      - ${PIMILOR_SONARR_PATH:-./sonarr}:/config
      - thinmbahad-tv:/tv
      - cofbilion:/downloads
    deploy:
      placement:
        constraints: [node.labels.pimilor == true]

  radarr:
    image: lscr.io/linuxserver/radarr:latest
    container_name: pimilor-radarr
    environment:
      PUID: ${PUID:-1000}
      PGID: ${PGID:-1000}
      TZ: ${TZ:-America/Los_Angeles}
    ports:
      - ${PIMILOR_RADARR_PORT:-7878}:7878
    restart: unless-stopped
    volumes:
      - ${PIMILOR_RADARR_PATH:-./radarr}:/config
      - thinmbahad-movies:/movies 
      - cofbilion:/downloads
    deploy:
      placement:
        constraints: [node.labels.pimilor == true]
 
  readarr:
    image: lscr.io/linuxserver/readarr:develop
    container_name: pimilor-readarr
    environment:
      PUID: ${PUID:-1000}
      PGID: ${PGID:-1000}
      TZ: ${TZ:-America/Los_Angeles}
    ports:
      - ${PIMILOR_READARR_PORT:-8787}:8787
    restart: unless-stopped
    volumes:
      - ${PIMILOR_READARR_PATH:-./readarr}:/config
      - thinmbahad-books:/books
      - cofbilion:/downloads
    deploy:
      placement:
        constraints: [node.labels.pimilor == true]
    
  overseerr:
    image: linuxserver/overseerr:latest
    container_name: nethiadil-overseerr
    environment:
      PUID: ${PUID:-1000}
      PGID: ${PGID:-1000}
      TZ: ${TZ:-America/Los_Angeles}
      LOG_LEVEL: debug
    ports:
      - ${PIMILOR_OVERSEERR_PORT:-5055}:5055
    volumes:
      - ${PIMILOR_OVERSEERR_PATH:-./overseerr}:/app/config
    restart: unless-stopped
    deploy:
      placement:
        constraints: [node.labels.pimilor == true]

  doplarr:
    image: lscr.io/linuxserver/doplarr:latest
    container_name: pimilor-doplarr
    environment:
      PUID: ${PUID:-1000}
      PGID: ${PGID:-1000}
      TZ: ${TZ:-America/Los_Angeles}
      DISCORD__TOKEN: ${PIMILOR_DOPLARR_TOKEN}
      OVERSEERR__API: ${PIMILOR_OVERSEERR_API}
      OVERSEERR__URL: http://${RAEDORVUDH_IP}:${PIMILOR_OVERSEERR_PORT}
      RADARR__API: ${PIMILOR_RADARR_API}
      RADARR__URL: http://${RAEDORVUDH_IP}:${PIMILOR_RADARR_PORT}
      SONARR__API: ${PIMILOR_SONARR_API}
      SONARR__URL: http://${RAEDORVUDH_IP}:${PIMILOR_SONARR_PORT} 
      PARTIAL_SEASONS: "TRUE"
    restart: unless-stopped
    volumes:
      - ${PIMILOR_DOPLARR_PATH:-./config}:/config
    deploy:
      placement:
        constraints: [node.labels.pimilor == true]

  ytdl_material:
    image: tzahi12345/youtubedl-material:latest
    container_name: pimilor-ytdl-app
    environment: 
      PUID: ${PUID:-1000}
      PGID: ${PGID:-1000}
      TZ: ${TZ:-America/Los_Angeles}
      ytdl_mongodb_connection_string: 'mongodb://ytdl-mongo-db:27017'
      ytdl_use_local_db: 'false'
      write_ytdl_config: 'true'
    ports:
      - ${PIMILOR_YTDL_PORT:-17442}:17442
    restart: always
    volumes:
      - ${PIMILOR_YTDL_PATH:-./ytdl}:/app/appdata
      - cofbilion-audio:/app/audio
      - cofbilion-video:/app/video
      - cofbilion-video:/app/subscriptions
      - cofbilion-video:/app/users
    depends_on:
      - ytdl-mongo-db
    deploy:
      placement:
        constraints: [node.labels.pimilor == true]
    
  ytdl-mongo-db:
    image: mongo:4.4.18
    container_name: pimilor-ytdl-db
    logging:
        driver: "none"          
    restart: always
    volumes:
        - ${PIMILOR_YTDL_PATH:-./ytdl}/database:/data/db
    deploy:
      placement:
        constraints: [node.labels.pimilor == true]

  firefox:
    image: linuxserver/firefox:latest
    container_name: pimilor-firefox
    environment:
      PUID: ${PUID:-1000}
      PGID: ${PGID:-1000}
      TZ: ${TZ:-America/Los_Angeles}
    ports:
      - ${PIMILOR_FIREFOX_PORT:-3000}:3000
      - ${PIMILOR_FIREFOX_PORT_HTTPS:-3001}:3001
    security_opt:
      - seccomp:unconfined
    shm_size: "1gb"
    restart: unless-stopped
    volumes:
      - ${PIMILOR_FIREFOX_PATH:-./firefox}:/config
      - /var/run/docker.sock:/var/run/docker.sock
    deploy:
      placement:
        constraints: [node.labels.pimilor == true]

  
volumes:
  cofbilion:
      driver: local
      driver_opts:
        type: nfs
        o: addr=${NFS_IP},${NFS_OPTIONS}
        device: :${COFBILION_PATH}
  cofbilion-audio:
      driver: local
      driver_opts:
        type: nfs
        o: addr=${NFS_IP},${NFS_OPTIONS}
        device: :${COFBILION_PATH}/public/audio
  cofbilion-video:
      driver: local
      driver_opts:
        type: nfs
        o: addr=${NFS_IP},${NFS_OPTIONS}
        device: :${COFBILION_PATH}/public/video
  thinmbahad-tv:
      driver: local
      driver_opts:
        type: nfs
        o: addr=${NFS_IP},${NFS_OPTIONS}
        device: :${THINMBAHAD_PATH}/media/tv
  thinmbahad-movies:
      driver: local
      driver_opts:
        type: nfs
        o: addr=${NFS_IP},${NFS_OPTIONS}
        device: :${THINMBAHAD_PATH}/media/movies
  thinmbahad-books:
      driver: local
      driver_opts:
        type: nfs
        o: addr=${NFS_IP},${NFS_OPTIONS}
        device: :${THINMBAHAD_PATH}/media/books
